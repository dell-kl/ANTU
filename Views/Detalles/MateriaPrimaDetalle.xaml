<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="ANTU.Views.Detalles.MateriaPrimaDetalle"
             Title="MateriaPrimaDetalle"
             xmlns:toolkit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
             xmlns:syncfusion="clr-namespace:Syncfusion.Maui.DataGrid;assembly=Syncfusion.Maui.DataGrid"
             xmlns:shimmer="clr-namespace:Syncfusion.Maui.Shimmer;assembly=Syncfusion.Maui.Core"
             xmlns:dataForm="clr-namespace:Syncfusion.Maui.DataForm;assembly=Syncfusion.Maui.DataForm"
             xmlns:valueConverter="clr-namespace:ANTU.Resources.ValueConverter"
             xmlns:restManagement="clr-namespace:ANTU.Resources.Rest.RestInterfaces"
             xmlns:viewModel="clr-namespace:ANTU.ViewModel"
             BackgroundColor="#D9D6D2"
             x:Name="ContentPageMain"
             x:DataType="viewModel:MateriaPrimaDetalleViewModel">

    <ContentPage.Resources>
        <ResourceDictionary>
            <valueConverter:ImageValueConverter x:Key="KeyImageValueConverter"/>
        </ResourceDictionary>
    </ContentPage.Resources>
    
    <Shell.TabBarIsVisible>False</Shell.TabBarIsVisible>
    <Shell.TitleView>
        <StackLayout>
            <Label
                x:Name="TituloMateriaPrima"
                FontSize="20"
                FontFamily="SegoeUIBold"
                Text="{Binding MateriaPrimaProducto.nombreProducto}"/>
            <Label
                Margin="0,-10,0,0"
                FontFamily="SegoeUILight"
                Text="Conoce y gestiona tu materia prima"/>
        </StackLayout>
    </Shell.TitleView>


    <ScrollView>
        <VerticalStackLayout>
            <VerticalStackLayout.Background>
                <LinearGradientBrush StartPoint="0,0" EndPoint="0,1">
                    <GradientStop Color="#F0E7DA" Offset=".6" />
                    <GradientStop Color="#FFF" Offset="1" />
                </LinearGradientBrush>
            </VerticalStackLayout.Background>

            <Border 
                Margin="10,15,10,10"
                StrokeShape="RoundRectangle 10,10,10,10"
                StrokeThickness="0"
                BackgroundColor="#FFF">
                <VerticalStackLayout>
                    <Grid 
                        Padding="10"
                        ColumnSpacing="10"
                        RowDefinitions="*"
                        ColumnDefinitions=".9*,.3*">
                        <StackLayout
                            Grid.Row="0"
                            Grid.Column="0">
                            <Border
                                Stroke="#BF7A24"
                                StrokeThickness="2"
                                StrokeShape="RoundRectangle 15,15,15,15">
                                <Border.Shadow>
                                    <Shadow
                                        Brush="#BF8924"
                                        Offset="0,3"
                                        Radius="12"
                                        Opacity="10"/>
                                </Border.Shadow>

                                <Image
                                    Opacity=".8"
                                    Aspect="Fill"
                                    HeightRequest="160"
                                    BackgroundColor="LightGray"
                                    x:Name="ImagenPresentacionMateriaPrimaDetalle"
                                    IsAnimationPlaying="True"
                                    Source="{Binding MateriaPrimaDetalle.imagenes[0].Url, Converter={StaticResource Key='KeyImageValueConverter'}}">
                                </Image>
                            </Border>
                        </StackLayout>
                        <StackLayout
                            Padding="0,5,0,0"
                            Grid.Row="0"
                            Spacing="10"
                            Grid.Column="1">
                            <Button
                                FontSize="25"
                                BorderColor="#BF7A24"
                                BorderWidth="2"
                                BackgroundColor="Transparent"
                                FontAttributes="Bold"
                                FontFamily="SegoeUILight"
                                Text="ðŸ“·">
                                <Button.Behaviors>
                                    <toolkit:TouchBehavior
                                        Command="{Binding MostrarDetallesImagenesCommand}"
                                        PressedBackgroundColor="#BF7A24"/>
                                </Button.Behaviors>
                            </Button>
                            <Button
                                FontSize="25"
                                BackgroundColor="Transparent"
                                BorderColor="#8C3623"
                                BorderWidth="2"
                                FontAttributes="Bold"
                                FontFamily="SegoeUILight"
                                Text="ðŸ“">
                                <Button.Behaviors>
                                    <toolkit:TouchBehavior
                                        Command="{Binding VentanaFormularioEditarDatosMateriaPrimaCommand}"
                                        PressedBackgroundColor="#8C3623"/>
                                </Button.Behaviors>
                            </Button>
                        </StackLayout>
                    </Grid>

                    <Grid 
                        Padding="10"
                        Margin="0,0,0,0" RowSpacing="15" ColumnSpacing="20" ColumnDefinitions="*,*" RowDefinitions="*,*">
                        <Border 
                            StrokeThickness="0"
                            BackgroundColor="#26F0A313"
                            Grid.Row="0" 
                            StrokeShape="RoundRectangle 5,5,5,5"
                            Grid.Column="0">

                            <shimmer:SfShimmer 
                                IsActive="True"
                                x:Name="ShimmerKgTotal"
                                AnimationDuration="2000"
                                BackgroundColor="Transparent"
                                Fill="#BF7A24">
                                <shimmer:SfShimmer.CustomView>

                                    <FlexLayout 
                                        JustifyContent="Center"
                                        AlignItems="Center"
                                        Direction="Column">
                                        <shimmer:ShimmerView
                                            WidthRequest="30"
                                            HeightRequest="30"
                                            ShapeType="Circle"/>
                                        <shimmer:ShimmerView
                                            Margin="0,8,0,0"
                                            WidthRequest="100"
                                            HeightRequest="10"
                                            ShapeType="RoundedRectangle"/>
                                    </FlexLayout>
                                </shimmer:SfShimmer.CustomView>
                                <StackLayout
                                    Margin="0,10,0,10"
                                    MaximumWidthRequest="110"
                                    VerticalOptions="Center"
                                    HorizontalOptions="Center">
                                    <Label 
                                        FontFamily="SegoeUIBold"
                                        FontAttributes="Bold"
                                        FontSize="25"
                                        HorizontalTextAlignment="Center"
                                        TextColor="#BF7A24"
                                        Text="{Binding MateriaPrimaDetalle.KgTotal, StringFormat='{0} KG'}"/>
                                    <Label
                                        FontFamily="SegoeUILight"
                                        FontAttributes="Bold"
                                        FontSize="15"
                                        HorizontalTextAlignment="Center"
                                        TextColor="#BF8924"
                                        Text="Stock Actual"/>
                                </StackLayout>
                            </shimmer:SfShimmer>
                        </Border>
                        <Border 
                            StrokeThickness="0"
                            BackgroundColor="#26F0A313"
                            Grid.Row="0" 
                            StrokeShape="RoundRectangle 5,5,5,5"
                            Grid.Column="1">
                            <shimmer:SfShimmer 
                                IsActive="True"
                                x:Name="ShimmerTotalCompra"
                                AnimationDuration="2000"
                                BackgroundColor="Transparent"
                                Fill="#BF7A24">
                                <shimmer:SfShimmer.CustomView>

                                    <FlexLayout 
                                        JustifyContent="Center"
                                        AlignItems="Center"
                                        Direction="Column">
                                        <shimmer:ShimmerView
                                            WidthRequest="30"
                                            HeightRequest="30"
                                            ShapeType="Circle"/>
                                        <shimmer:ShimmerView
                                            Margin="0,8,0,0"
                                            WidthRequest="100"
                                            HeightRequest="10"
                                            ShapeType="RoundedRectangle"/>
                                    </FlexLayout>
                                </shimmer:SfShimmer.CustomView>
                                <StackLayout
                                    Margin="0,10,0,10"
                                    MaximumWidthRequest="110"
                                    VerticalOptions="Center"
                                    HorizontalOptions="Center">
                                    <Label 
                                        FontFamily="SegoeUIBold"
                                        FontAttributes="Bold"
                                        FontSize="25"
                                        HorizontalTextAlignment="Center"
                                        TextColor="#BF7A24"
                                        Text="{Binding MateriaPrimaDetalle.TotalCompras}"/>
                                    <Label
                                        FontFamily="SegoeUILight"
                                        FontAttributes="Bold"
                                        FontSize="15"
                                        HorizontalTextAlignment="Center"
                                        TextColor="#BF8924"
                                        Text="Total Compras"/>
                                </StackLayout>
                            </shimmer:SfShimmer>
                        </Border>


                        <Border 
                            StrokeThickness="0"
                            BackgroundColor="#26F0A313"
                            Grid.Row="1" 
                            StrokeShape="RoundRectangle 5,5,5,5"
                            Grid.Column="0">

                            <shimmer:SfShimmer 
                                IsActive="True"
                                x:Name="ShimmerPrecioPromedio"
                                AnimationDuration="2000"
                                BackgroundColor="Transparent"
                                Fill="#BF7A24">
                                <shimmer:SfShimmer.CustomView>

                                    <FlexLayout 
                                        JustifyContent="Center"
                                        AlignItems="Center"
                                        Direction="Column">
                                        <shimmer:ShimmerView
                                            WidthRequest="30"
                                            HeightRequest="30"
                                            ShapeType="Circle"/>
                                        <shimmer:ShimmerView
                                            Margin="0,8,0,0"
                                            WidthRequest="100"
                                            HeightRequest="10"
                                            ShapeType="RoundedRectangle"/>
                                    </FlexLayout>
                                </shimmer:SfShimmer.CustomView>

                                <StackLayout
                                    Margin="0,10,0,10"
                                    MaximumWidthRequest="110"
                                    VerticalOptions="Center"
                                    HorizontalOptions="Center">
                                    <Label 
                                        FontFamily="SegoeUIBold"
                                        FontAttributes="Bold"
                                        FontSize="25"
                                        HorizontalTextAlignment="Center"
                                        TextColor="#BF7A24"
                                        Text="{Binding MateriaPrimaProducto.status}"/>
                                    <Label
                                        FontFamily="SegoeUILight"
                                        FontAttributes="Bold"
                                        FontSize="15"
                                        HorizontalTextAlignment="Center"
                                        TextColor="#BF8924"
                                        Text="Stock"/>
                                </StackLayout>
                            </shimmer:SfShimmer>
                        </Border>

                        <Border 
                            StrokeThickness="0"
                            BackgroundColor="#26F0A313"
                            Grid.Row="1" 
                            StrokeShape="RoundRectangle 5,5,5,5"
                            Grid.Column="1">

                            <shimmer:SfShimmer 
                                IsActive="True"
                                x:Name="ShimmerUltimaCompra"
                                AnimationDuration="2000"
                                BackgroundColor="Transparent"
                                Fill="#BF7A24">
                                <shimmer:SfShimmer.CustomView>

                                    <FlexLayout 
                                        JustifyContent="Center"
                                        AlignItems="Center"
                                        Direction="Column">
                                        <shimmer:ShimmerView
                                            WidthRequest="30"
                                            HeightRequest="30"
                                            ShapeType="Circle"/>
                                        <shimmer:ShimmerView
                                            Margin="0,8,0,0"
                                            WidthRequest="100"
                                            HeightRequest="10"
                                            ShapeType="RoundedRectangle"/>
                                    </FlexLayout>
                                </shimmer:SfShimmer.CustomView>
                                <StackLayout
                                    Margin="0,10,0,10"
                                    MaximumWidthRequest="110"
                                    VerticalOptions="Center"
                                    HorizontalOptions="Center">
                                    <Label 
                                        FontFamily="SegoeUIBold"
                                        FontAttributes="Bold"
                                        FontSize="25"
                                        HorizontalTextAlignment="Center"
                                        TextColor="#BF7A24"
                                        Text="{Binding MateriaPrimaDetalle.UltimaCompra, StringFormat='${0}'}"/>
                                    <Label
                                        FontFamily="SegoeUILight"
                                        FontAttributes="Bold"
                                        FontSize="15"
                                        HorizontalTextAlignment="Center"
                                        TextColor="#BF8924"
                                        Text="Ultima Compra"/>
                                </StackLayout>
                            </shimmer:SfShimmer>
                        </Border>

                    </Grid>
                </VerticalStackLayout>
            </Border>

            <Button
                FontSize="20"
                TextColor="#FFF"
                BackgroundColor="#BF8924"
                WidthRequest="340"
                FontFamily="SegoeUIBold"
                Command="{Binding VentanaFormularioMateriaPrimaDetalleStockCommand}"
                Text="+ Agregar Stock a Bodega"/>

            <Border
                Margin="0,10,0,0"
                BackgroundColor="#FFF"
                StrokeThickness="0">
                <StackLayout>
                    <Label
                        Margin="0,10,0,0"
                        FontFamily="SegoeUIBold"
                        FontAttributes="Bold"
                        TextColor="#000"
                        FontSize="25"
                        HorizontalTextAlignment="Center"
                        Text="ðŸ“‘Historial de Compras"/>

                    <Border
                        StrokeThickness="0"
                        WidthRequest="200"
                        HorizontalOptions="End"
                        Margin="0,0,10,0"
                        StrokeShape="RoundRectangle 5,5,5,5">
                        <StackLayout
                            BackgroundColor="#7F977018">
                            <SearchBar
                                CancelButtonColor="#FFF"
                                IsSpellCheckEnabled="True"
                                IsTextPredictionEnabled="True"
                                TextColor="#FFF"
                                FontAttributes="Bold"
                                FontSize="15"
                                TextChanged="SearchMateriaPrimaSeguimiento_TextChanged"
                                x:Name="SearchMateriaPrimaSeguimiento"
                                PlaceholderColor="#FFF"
                                Placeholder="Buscar en la tabla"
                                FontFamily="SegoeUILight"/>
                        </StackLayout>
                    </Border>

                    <syncfusion:SfDataGrid
                        Margin="0,0,0,10"
                        SortingMode="Single"
                        HeaderRowHeight="80"
                        EnableDataVirtualization="True"
                        MaximumHeightRequest="500"
                        AllowAsyncScrolling="True"
                        ItemsSource="{Binding MateriaPrimaDetalle.KgSeguimiento}"
                        x:Name="MateriaPrimaSeguimiento">
                        <syncfusion:SfDataGrid.DefaultStyle>
                            <syncfusion:DataGridStyle SearchTextColor="Black" 
                                            SearchTextBackground="LightBlue" 
                                            SearchHighlightTextColor="Black" 
                                            SearchHighlightTextBackground="LightGreen" />
                        </syncfusion:SfDataGrid.DefaultStyle>
                        <syncfusion:SfDataGrid.Columns>
                            <syncfusion:DataGridDateColumn
                                HeaderText="Fecha Compra"
                                MappingName="fechaCompra"
                                ColumnWidthMode="Fill"
                                Width="120"
                                LoadUIView="False"/>
                            <syncfusion:DataGridNumericColumn
                                HeaderText="Precio Final"
                                Format="$0.00"
                                MappingName="precioTotal"
                                Width="90"
                                LoadUIView="False"/>
                            <syncfusion:DataGridNumericColumn
                                HeaderText="KG Total"
                                Format="KG 0.00"
                                MappingName="KgTotal"
                                Width="110"
                                LoadUIView="False"/>
                            <syncfusion:DataGridNumericColumn
                            HeaderText="Precio Unit"
                            Format="$ 0.00"
                            MappingName="precioUnitario"
                            Width="100"
                            LoadUIView="False"
                            />
                            <syncfusion:DataGridNumericColumn
                            HeaderText="KG Estandard"
                            Format="KG 0.00"
                            MappingName="KgEstandar"
                            Width="125"
                            LoadUIView="False"/>

                        </syncfusion:SfDataGrid.Columns>
                    </syncfusion:SfDataGrid>
                </StackLayout>                
            </Border>
        </VerticalStackLayout>
    </ScrollView>
</ContentPage>